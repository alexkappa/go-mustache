box: golang
build:
  steps:
    - wercker/setup-go-workspace:
        package-dir: github.com/alexkappa/exp
    - script:
        name: update submodules
        code: |
          git submodule update --init --recursive
    - script:
        name: go build
        code: |
          go build
    - script:
        name: go test
        code: |
          go test -coverprofile=coverage.out
    - script:
        name: copy files
        code: |
          cp coverage.out $WERCKER_OUTPUT_DIR/
send-coverage:
  box: node
  steps:
    - script:
        name: copy files
        code: |
          cp $WERCKER_OUTPUT_DIR/coverage.out .
    - script:
        name: install codeclimate test reporter
        code: |
          npm install -g codeclimate-test-reporter
    - script:
        name: send coverage
        code: |
          CODECLIMATE_REPO_TOKEN=$CODECLIMATE_REPO_TOKEN codeclimate-test-reporter < coverage.out                                                                                                   [17:29:49]
